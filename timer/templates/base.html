{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{% block title %}{% endblock title %}</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=Vazirmatn:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:wght@300;400;600&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="{% static 'css/app.css' %}" />
    {% block header %}{% endblock header %}
  </head>
  <body>
    <div class="app">
      {% include "header.html" %}
      <main class="app__content">
        {% block body %}{% endblock body %}
      </main>
    </div>
    <script src="https://unpkg.com/htmx.org@1.9.12"></script>
    <script src="{% static 'js/theme.js' %}"></script>
    <script>
      document.addEventListener("click", (event) => {
        const openTarget = event.target.closest("[data-modal-open]");
        if (openTarget) {
          const modalId = openTarget.getAttribute("data-modal-open");
          const modal = document.getElementById(modalId);
          if (modal) {
            modal.classList.add("is-open");
            modal.setAttribute("aria-hidden", "false");
          }
        }
        if (event.target.closest("[data-modal-close]")) {
          const modal = event.target.closest(".modal");
          if (modal) {
            modal.classList.remove("is-open");
            modal.setAttribute("aria-hidden", "true");
          }
        }

        const taskCard = event.target.closest(".task");
        if (taskCard && !event.target.closest("button") && !event.target.closest("a") && !event.target.closest("form")) {
          const modal = document.getElementById("todo-detail-modal");
          if (modal) {
            modal.classList.add("is-open");
            modal.setAttribute("aria-hidden", "false");
            const title = taskCard.getAttribute("data-task-title") || "—";
            const project = taskCard.getAttribute("data-task-project") || "—";
            const priority = taskCard.getAttribute("data-task-priority") || "—";
            const details = taskCard.getAttribute("data-task-details") || "—";
            const due = taskCard.getAttribute("data-task-due") || "—";
            const titleEl = document.getElementById("task-detail-title");
            const projectEl = document.getElementById("task-detail-project");
            const priorityEl = document.getElementById("task-detail-priority");
            const detailsEl = document.getElementById("task-detail-details");
            const dueEl = document.getElementById("task-detail-due");
            if (titleEl) titleEl.textContent = title;
            if (projectEl) projectEl.textContent = project;
            if (priorityEl) priorityEl.textContent = priority;
            if (detailsEl) detailsEl.textContent = details;
            if (dueEl) dueEl.textContent = due;
          }
        }
      });
      document.addEventListener("keydown", (event) => {
        if (event.key === "Escape") {
          document.querySelectorAll(".modal.is-open").forEach((modal) => {
            modal.classList.remove("is-open");
            modal.setAttribute("aria-hidden", "true");
          });
        }
      });
    </script>
    {% block script %}{% endblock script %}
  </body>
</html>
